{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack://Trans/webpack/universalModuleDefinition","webpack://Trans/webpack/bootstrap","webpack://Trans/webpack/runtime/define property getters","webpack://Trans/webpack/runtime/hasOwnProperty shorthand","webpack://Trans/webpack/runtime/make namespace object","webpack://Trans/./core/types.ts","webpack://Trans/./core/errors.ts","webpack://Trans/./core/Trans/helpers.ts","webpack://Trans/./core/ContentPreparer/helpers.ts","webpack://Trans/./core/ContentPreparer/ContentPreparer.ts","webpack://Trans/./core/Trans/EventsManager.ts","webpack://Trans/./core/Trans/Trans.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Trans\"] = factory();\n\telse\n\t\troot[\"Trans\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// eslint-disable-next-line max-classes-per-file\nimport { TransError } from './errors';\n\nexport type Content = Record<string, unknown>;\nexport type DynamicContent = () => Promise<{ default: Content }>;\nexport type Variables = Record<string, string>;\nexport type ErrorsMode = 'ignore' | 'throw' | 'console' | ((error: TransError) => string);\nexport type PluralContent = Partial<Record<Intl.LDMLPluralRule, string>>;\nexport type PluralFn = (count: number, locale: string) => Intl.LDMLPluralRule;\nexport type Handler = ((...args: unknown[]) => void) | (() => void);\nexport type LoadStartEvent = 'loadstart';\nexport type LoadEndEvent = 'loadend';\nexport type ChangeLocaleEvent = 'change-locale';\nexport type InitEvent = 'init';\n\nexport type Event = LoadEndEvent | LoadStartEvent | ChangeLocaleEvent | InitEvent;\n\nexport declare class EventsManager {\n  handlersMap: Map<Event, Handler[]>;\n\n  private _getHandlers(event: Event, handler: Handler): Handler[];\n\n  addEventListener(event: LoadEndEvent, handler: () => void): void;\n\n  addEventListener(event: LoadStartEvent, handler: () => void): void;\n\n  addEventListener(event: ChangeLocaleEvent, handler: (locale: string) => void): void;\n\n  addEventListener(event: InitEvent, handler: (locale: string) => void): void;\n\n  removeEventListener(event: Event, handler: Handler): void;\n\n  protected emit(event: ChangeLocaleEvent, locale: string): void;\n\n  protected emit(event: InitEvent, locale: string): void;\n\n  protected emit(event: LoadEndEvent): void;\n\n  protected emit(event: LoadStartEvent): void;\n}\n\nexport enum Config {\n  count = 'COUNT',\n}\n\nexport type TranslateOptions<T extends Variables = Variables> = {\n  /**\n   * ignore the error, handle error, show in the console or throw error (by default)\n   * */\n  errorsMode?: ErrorsMode;\n  /**\n   * it uses for the plural if it exists\n   * */\n  count?: number;\n  /**\n   * for replaced the variable patters: ${variable}\n   * */\n  variables?: T;\n};\n\nexport type Translate<T extends Variables = Variables> = (\n  path: string | TemplateStringsArray,\n  options?: TranslateOptions<T>\n) => string;\n\nexport declare class Trans<Locale extends string = string> extends EventsManager {\n  locale: Locale;\n\n  errorsMode: ErrorsMode;\n\n  content: Content;\n\n  init(params: {\n    translations: Record<Locale, Content> | Record<Locale, DynamicContent>;\n    locale: Locale;\n    pluralRecord?: Record<Locale, PluralFn>;\n  }): Promise<void>;\n\n  changeLocale(locale: Locale): Promise<void>;\n\n  createTranslate<T extends Variables = Variables>(module?: string | TemplateStringsArray): Translate<T>;\n}\n","/* eslint-disable max-classes-per-file */\n\nexport class ContentNotFound extends Error {}\nexport class ContentNotPlural extends Error {}\nexport class PluralNotSupport extends Error {}\nexport class InvalidTranslate extends Error {}\nexport class InvalidPath extends Error {}\nexport class InvalidErrorMode extends Error {}\n\nexport type TransError = InvalidTranslate | ContentNotFound | ContentNotPlural;\n","import { Content, ErrorsMode } from '../types';\nimport { InvalidErrorMode, InvalidPath } from '../errors';\n\nexport type PathArray = string[];\n\nexport const preparePath = (path: string): PathArray => path.split('.');\n\nexport const parsePath = (path: string | TemplateStringsArray): string => {\n  if (Array.isArray(path)) return path[0];\n  if (typeof path === 'string') return path;\n  if (path === undefined) return '';\n  throw new InvalidPath(`invalid path: ${path}, path as json: ${JSON.stringify(path)}`);\n};\n\nexport const getContentRecursive = (content: Content, pathArray: PathArray): Content | string => {\n  if (!content) return content;\n  const path = pathArray.shift();\n  if (pathArray.length) {\n    return getContentRecursive((content as Record<string, Content>)[path], pathArray);\n  }\n  if (path) {\n    return content[path] as Content | string;\n  }\n  return content;\n};\n\nexport const getContent = (content: Content | string, path: string): Content | string => {\n  if (!content || typeof content !== 'object') return content;\n  const pathArray = preparePath(path);\n  return getContentRecursive(content, pathArray);\n};\n\nexport const validate = (callback: () => string, errorsMode: ErrorsMode, extra = ''): string | never => {\n  try {\n    return callback();\n  } catch (e) {\n    if (errorsMode === 'ignore') return '';\n    const error = new Error([e.message, extra].filter(Boolean).join('. '));\n    if (errorsMode === 'console') {\n      console.error(error); // eslint-disable-line no-console\n      return '';\n    }\n    if (errorsMode === 'throw') throw error;\n    if (typeof errorsMode === 'function') return errorsMode(error);\n    throw new InvalidErrorMode(`errorsMode: \"${errorsMode}\"; as a json: ${JSON.stringify(errorsMode)}`);\n  }\n};\n","import { PluralContent } from '../types';\nimport { ContentNotPlural, InvalidTranslate, PluralNotSupport } from '../errors';\nimport { ContentPreparerOptions } from './ContentPreparer';\n\nexport const defaultPluralFn = (count: number, locale: string): Intl.LDMLPluralRule => {\n  try {\n    return new Intl.PluralRules(locale).select(count);\n  } catch (e) {\n    if (e.message === 'Intl is not defined') {\n      throw new PluralNotSupport(\n        `plural by default is not supported. Try to add a polyfill for Intl: https://formatjs.io/docs/polyfills/intl-pluralrules/ or you should to pass a pluralRecord with own functions for plural`\n      );\n    }\n    throw e;\n  }\n};\n\nexport const setCount = <Locale extends string>({\n  count,\n  content,\n  pluralFn,\n  locale,\n}: {\n  count: number;\n  locale: Locale;\n  content: PluralContent;\n  pluralFn: ContentPreparerOptions<Locale>['pluralFn'];\n}): string | never => {\n  if (!content || typeof content !== 'object') {\n    throw new ContentNotPlural(`content is not plural. content: \"${content}\"; as a json: ${JSON.stringify(content)}`);\n  }\n  const key = pluralFn(count, locale);\n  const result = content[key];\n  if (typeof result !== 'string')\n    throw new InvalidTranslate(`invalid translate. Translated result: ${result}; as a json: ${JSON.stringify(result)}`);\n  return result;\n};\n\nexport const setVariable = (content: string, variable: { key: string; value: string }): string => {\n  const regExp = new RegExp(`\\\\\\${${variable.key}}`, 'g');\n  return content.replace(regExp, variable.value);\n};\n","import { Config, Content, PluralContent, PluralFn, Variables } from '../types';\nimport { InvalidTranslate } from '../errors';\nimport { defaultPluralFn, setCount, setVariable } from './helpers';\nimport { getContent, parsePath } from '../Trans/helpers';\n\nexport type ContentPreparerOptions<Locale extends string> = {\n  pluralFn?: PluralFn;\n  locale: Locale;\n  path?: string | TemplateStringsArray;\n};\n\nexport class ContentPreparer<Locale extends string> {\n  private locale: Locale;\n\n  private _content: Content | string;\n\n  private pluralFn: ContentPreparerOptions<Locale>['pluralFn'];\n\n  set(content: Content | string, options: ContentPreparerOptions<Locale>): this {\n    const { pluralFn = defaultPluralFn, locale, path = '' } = options;\n    const parsedPath = parsePath(path);\n    this._content = getContent(content, parsedPath);\n    this.locale = locale;\n    this.pluralFn = pluralFn;\n    return this;\n  }\n\n  setVariables(variables: Variables): this {\n    if (!variables || typeof variables !== 'object') return this;\n    if (typeof this._content !== 'string') {\n      throw new InvalidTranslate(`invalid content: \"${this._content}\"; as a json: ${JSON.stringify(this._content)}`);\n    }\n    let result = this._content;\n    const keys = Object.keys(variables);\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      result = setVariable(result, { key, value: variables[key] });\n    }\n    this._content = result;\n    return this;\n  }\n\n  setCount(count: number): this {\n    if (!count && count !== 0) return this;\n    this._content = setVariable(\n      setCount({\n        count,\n        content: this._content as PluralContent,\n        pluralFn: this.pluralFn,\n        locale: this.locale,\n      }),\n      { key: Config.count, value: count.toString() }\n    );\n    return this;\n  }\n\n  get content(): string | Content {\n    return this._content;\n  }\n}\n","export type Handler = ((...args: unknown[]) => void) | (() => void);\nexport type LoadStartEvent = 'loadstart';\nexport type LoadEndEvent = 'loadend';\nexport type ChangeLocaleEvent = 'change-locale';\nexport type InitEvent = 'init';\n\nexport type Event = LoadEndEvent | LoadStartEvent | ChangeLocaleEvent | InitEvent;\n\nexport class EventsManager {\n  handlersMap: Map<Event, Handler[]>;\n\n  constructor() {\n    this.handlersMap = new Map<Event, Handler[]>();\n  }\n\n  private _getHandlers(event: Event, handler: Handler): Handler[] {\n    return this.handlersMap.get(event).filter((h) => h !== handler);\n  }\n\n  addEventListener(event: LoadEndEvent, handler: () => void): void;\n\n  addEventListener(event: LoadStartEvent, handler: () => void): void;\n\n  addEventListener(event: ChangeLocaleEvent, handler: (locale: string) => void): void;\n\n  addEventListener(event: InitEvent, handler: (locale: string) => void): void;\n\n  addEventListener(event: Event, handler: Handler): void {\n    if (this.handlersMap.has(event)) {\n      const handlers = this._getHandlers(event, handler);\n      handlers.push(handler);\n      this.handlersMap.set(event, handlers);\n      return;\n    }\n    this.handlersMap.set(event, [handler]);\n  }\n\n  removeEventListener(event: Event, handler: Handler): void {\n    if (this.handlersMap.has(event)) {\n      const handlers = this._getHandlers(event, handler);\n      this.handlersMap.set(event, handlers);\n    }\n  }\n\n  protected emit(event: ChangeLocaleEvent, locale: string): void;\n\n  protected emit(event: InitEvent, locale: string): void;\n\n  protected emit(event: LoadEndEvent): void;\n\n  protected emit(event: LoadStartEvent): void;\n\n  protected emit(event: Event, ...args: unknown[]): void {\n    if (this.handlersMap.has(event)) {\n      const handlers = this.handlersMap.get(event);\n      handlers.forEach((handler) => handler(...args), this);\n    }\n  }\n}\n","import { Content, DynamicContent, ErrorsMode, PluralFn, Translate, TranslateOptions, Variables } from '../types';\nimport { getContent, parsePath, validate } from './helpers';\nimport { InvalidTranslate } from '../errors';\nimport { ContentPreparer } from '../ContentPreparer';\nimport { EventsManager } from './EventsManager';\n\nexport class Trans<Locale extends string = string> extends EventsManager {\n  locale: Locale;\n\n  errorsMode: ErrorsMode;\n\n  private translations: Record<Locale, Content | DynamicContent>;\n\n  private pluralRecord: Record<Locale, PluralFn>;\n\n  private contentPreparer: ContentPreparer<Locale>;\n\n  private initial: boolean;\n\n  content: Content;\n\n  constructor() {\n    super();\n    this.initial = false;\n    this.changeLocale = this.changeLocale.bind(this);\n    this._setContent = this._setContent.bind(this);\n    this.init = this.init.bind(this);\n    this.createTranslate = this.createTranslate.bind(this);\n  }\n\n  private async _setContent<T extends Content>(content: T | (() => Promise<{ default: T }>)): Promise<void> {\n    if (typeof content === 'function') {\n      this.emit('loadstart');\n      this.content = (await content()).default;\n      this.emit('loadend');\n    } else {\n      this.content = content;\n    }\n  }\n\n  async init(params: {\n    translations: Record<Locale, Content> | Record<Locale, DynamicContent>;\n    locale: Locale;\n    pluralRecord?: Record<Locale, PluralFn>;\n    errorsMode?: ErrorsMode;\n  }): Promise<void> {\n    const { translations, locale, pluralRecord, errorsMode = 'console' } = params;\n    const { [locale]: content } = translations;\n    this.errorsMode = errorsMode;\n    this.translations = translations;\n    this.pluralRecord = pluralRecord;\n    this.locale = locale;\n    this.contentPreparer = new ContentPreparer<Locale>();\n    await this._setContent(content);\n    this.initial = true;\n    this.emit('init', locale);\n  }\n\n  async changeLocale(locale: Locale): Promise<void> {\n    const { [locale]: content } = this.translations;\n    this.locale = locale;\n    await this._setContent(content);\n    this.emit('change-locale', locale);\n  }\n\n  createTranslate<T extends Variables = Variables>(module?: string | TemplateStringsArray): Translate<T> {\n    const parsedPath = parsePath(module);\n    const content = getContent(this.content, parsedPath);\n\n    return (path: string | TemplateStringsArray, options: TranslateOptions<T> = {}): string => {\n      // for loading case\n      if (!this.initial) return null;\n\n      const { errorsMode, count, variables } = options;\n      return validate(\n        () => {\n          const { locale, pluralRecord } = this;\n\n          // find in the current content\n          const result = this.contentPreparer\n            .set(content, { path, locale, pluralFn: pluralRecord?.[locale] })\n            .setCount(count)\n            .setVariables(variables).content;\n          if (typeof result === 'string') return result;\n\n          // find in the root\n          const rootResult = this.contentPreparer\n            .set(this.content, { path, locale, pluralFn: pluralRecord?.[locale] })\n            .setCount(count)\n            .setVariables(variables).content;\n          if (typeof rootResult === 'string') return rootResult;\n\n          throw new InvalidTranslate(\n            `invalid translate! result: \"${result}\"; result as a json: ${JSON.stringify(\n              result\n            )}; rootResult: \"${rootResult}\"; rootResult as a json: ${JSON.stringify(rootResult)}`\n          );\n        },\n        errorsMode || this.errorsMode,\n        `full path: \"${[module, path].filter(Boolean).join('.')}\"; translate path: \"${path}\";`\n      );\n    };\n  }\n}\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","Config","Error","parsePath","path","Array","isArray","undefined","InvalidPath","JSON","stringify","getContentRecursive","content","pathArray","shift","length","getContent","split","preparePath","defaultPluralFn","count","locale","Intl","PluralRules","select","e","message","PluralNotSupport","setVariable","variable","regExp","RegExp","replace","set","options","pluralFn","parsedPath","this","_content","setVariables","variables","InvalidTranslate","result","keys","i","setCount","ContentNotPlural","toString","handlersMap","Map","_getHandlers","event","handler","filter","h","addEventListener","has","handlers","push","removeEventListener","emit","forEach","args","initial","changeLocale","bind","_setContent","init","createTranslate","default","params","translations","pluralRecord","errorsMode","contentPreparer","ContentPreparer","callback","extra","error","Boolean","join","console","InvalidErrorMode","validate","rootResult","EventsManager"],"sourceRoot":""}